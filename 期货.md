brokerID是期货公司在ctp系统上的代码，不是交易所

InverstorID 客户在ctp系统上的唯一id，开户时由期货公司分配, 普通投资者登录CTP时UserID与InvestorID相同，
期货公司交易员登录CTP时，UserID为该交易员的用户名，代理客户交易时InvestorID为对应的投资者代码。

OrderRef: 交易终端使用frontID+sessionID+OrderRef唯一标示一笔报单，也可以使用exchangeID+ordersysid唯一标示一笔报单。OrderRef在frontID+sessionID相同的情况下必须单调递增，MaxOrderRef为当前frontID+sessionID下的最大值


强平原因ForceCloseReason一直设为非强平THOST_FTDC_FCC_NotForceClose
	在CTP中只有期货公司风控人员通过CTP风控终端报的强平单该字段才不等于THOST_FTDC_FCC_NotForceClose。

最小价位:价格变动的最小倍数，下单时,limitPrice要是它的倍数

条件单:一个单子是否是条件单, 取决于ContingentCondition和StopPrice两个参数

stopPrice/limitPrice：两者没有关系。
StopPrice 是条件单触发条件ContingentCondition的价格
limitPrice 是条件单触发产生的新报单的报单价格 

目前期货交易所无逐笔行情，只有快照。

好像回调的函数都有这个参数 包含错误信息  没出错就是空指针 CThostFtdcRspInfoField* pRspInfo,

期权权利金（Premium）即买卖 期权合约的价格

深度行情中 今虚实度 即:delta, 期货价格变动一个单位时，引起权利金变化的幅度。如看涨期权delta为0.4，意味着期货价格每变动一元，期权的价格则变动0.4元。

level2行情: level1的升级版，报单簿档位多，数据丰富，更新快，一般要单独收费

第一板 第一个涨停

涨停价，以结算价来算百分比，不固定

XQN行情加速器

交易单元 暂理解为交易通道

持仓盈亏，与平仓盈亏相对。交易者在交易闭市时所持有合约按当日结算价计算的持仓值与原持仓值的价差。

浮动盈亏分为累计浮动盈亏、当日浮动盈亏。在每日无负债结算制度下，交易所使用的是当日浮动盈亏概念。


临近交割月份但是还未到的就是近月合约。

现量：以最新价成交的合约数量

个人用户不可以进交割月份，到交割月份的最后一个交易日就要平仓。

买三手，可能三手都不是同时成交的，所以开仓价叫开仓均价 

我们只是使用ctp的很小一部分功能

每个交易软件都要实现的4个功能: 查 资金  委托  成交  持仓   软件每次启动都要查，有可能有更新，所以不能用缓存

定阅行情实际不用认证, 因广播发送

撮合时，时间、价格的比较只是最基础的，还可能比较报单量

### 涨跌
1. 涨跌：昨结算价 - 最新价
2. 涨跌幅: 涨跌 / 昨结算价

### 平仓顺序
1. 国内四家交易所的平仓顺序统一规则为先开先平。
2. 上期所的持仓分今仓（当日开仓）和昨仓（历史持仓），平仓时需要指定是平今仓还是昨仓。上期所使用THOST_FTDC_OF_Close == THOST_FTDC_OF_CloseYesterday，其它 THOST_FTDC_OF_CloseToday == THOST_FTDC_OF_CloseYesterday == THOST_FTDC_OF_Close(不能指定)
3. 郑商所在此基础上还有先平单腿持仓，再平组合持仓。
4. 除上期所外的三家交易所在涉及到平今手续费减免时先平今后平昨（后开先平）。 

【举例-1】
1. （未考虑平今减免）持仓 IF1601，昨仓 5 手，今仓 5 手；平仓 6 手，则先平昨仓 5 手，后平今仓 1 手，剩
余持仓为今仓 4 手。
2. （未考虑平今减免）郑商所持仓 a&b 组合持仓先开，3 手；a 单腿持仓后开，2 手；平仓 a 单腿，2 手，成
交后剩余持仓为 a&b 组合仓，3 手.
3. （未考虑平今减免）大商所持仓 a&b 组合先开，3 手；a 单腿持仓后开，2 手；平仓 a 单腿，2 手，成交后
剩余持仓为 a&b 组合持仓 1 手，a 单腿持仓 2 手，b 组合持仓 3 手。
4. （考虑平今减免）除上期所外的三家交易所在涉及到平今手续费减免时，如果有今仓，则优先平今仓；

### 套保
 CombHedgeFlag 需要获得交易所审批才能使用 套保, 其它皆为 投机
 锁定到期时的价格，来规避价格波动风险的,选套保后，不能平仓，到期后进行实物交割.一般是农民或农产品企业才做。
交易软件选择套保会享受交易所关于套期保值的相关优惠


### 封装接口
1. 封装原因,市场上有多个柜台系统，api和spi的方法名和参数都是不一样的，我们的目地就是将它们进行统一，使用的时候，就不用考虑某柜台的某方法的名字，数据结构是怎样的。
1. 首先按照行情、交易来划分两大类,每个类中再分请求为API，应答为SPI, 尽量以异步形式调用
2. SPI和API严格区分，功能不能重叠，如无特殊需求，方法定义不能放在同一文件中.
3. spi封装方法:从第三方的spi类继承一个类，该类会包含一个我方的spi成员对象，该对象是从stg接口派生出来的,将第三方spi返回的数据适配成我方数据格式后, 会传入我方的spi。 我方spi创建时会传入logger，为了记录接收到的数据
4. api封装方法:从stg接口派生出一个类，这个类会包含第三方的api和封装后的spi，这个api主要是将我方的数据适配成第三个的数据结构,再将数据传入第三方的api中

### 合约乘数 (某数乘这个数,目地是算出一份合约的价格)
1. 实物合约时，合约乘数就是交易单位(10吨/手)
2. 股指期货的指数是抽象的，合约标的为股指,没有类似一吨的交易单元，人为规定一个合约乘数(交易单位), 指数 * 合约乘数 = 合约金额
eg：沪深300指数在2500点时，300是合约乘数, 所以1手合约的金额就是2500×300=750000元。 

   
### 席位
1. 交易席位是证券公司在证券交易所交易大厅内进行交易的固定位置，其实质还包括了交易资格的含义
证券交易所会员的权利之一是参加交易，参加交易先要取得交易席位。证券交易所会员应当至少持有一个席位。证券交易所会员可以向证券交易所提出申请购买席位，也可以在证券交易所会员之间转让席位。证券交易所会员不得共有席位，席位也不得退回证券交易所。未经证券交易所同意，会员不得将席位出租、质押，或将席位所属权益以其他任何方式转给他人。
2. 主席意思就是期货开户以后默认的系统，次席就是要另外申请开通一下
3. 会员取得交易席位后，可向深交所申请多个交易单元，再通过交易单元参与证券交易
4. 会员每拥有一个席位享有一个交易单元的免费使用权、一份标准流速的免费使用权、一定的免费流量。
5. 席位是一个券商进行交易的中间步骤，成为深交所会员以后，再用60万买下一个交易席位，就拥有了参加交易的资格，再通过具体的交易单元来进行交易。

### 报单查询
1.就是查委托单，包括开仓平仓的,错误单

### 结算
1. 因为期货是每日结算，所以很多参数前都加上次
2. 交易保证金 当日结算时的交易保证金超过昨日结算时的交易保证金部分从会员结算准备金中扣划，当日结算时的交易保证金低于昨日结算时的交易保证金部分划入会员结算准备金。
期货保证金=期货昨结算价*合约乘数*保证金率
3. 结算准备金  会员账户中预先准备的资金，是未被合约占用的。结算准备金的最低余额由交易所决定。

### 期货账户里的钱不能全部取出
1. 某些期货公司有留底资金的要求。
2. 当日盈利部分需要下个交易日才可以取出.
3. 有持仓状态下，不可以全部取出，会有剩余可用资金的要求

### reqQryInvestorPosition  请求查询投资者持仓
1. 不是只返回当天，会返回近几天的数据

### tradeId
1. tradeid 成交id， OrderSysID 报单编号
2. ctp 的成交id是有可能重复的

### SL_Market  盛立极速行情柜台插件
1. 回调的行情会期货和期权, 其它的没有，因为是都可以接收

### 限价单
1. 必须 VolumeCondition = THOST_FTDC_VC_AV;
2. TimeCondition = THOST_FTDC_TC_IOC; 可以设成这个参数   如果价格不合适，会显示原因为  已撤单报单已提交
3. LimitPrice 只能设置在涨停跌停区间内

### 市价单
1. 每个交易所对市价的定义都不同  https://www.zhihu.com/question/47525423/answer/283867094 , 有些交易所不提供市价指令
2. 目前交易所默认不开通

### FOK & FAK
FOK:
OrderPriceType = THOST_FTDC_OPT_LimitPrice;
TimeCondition = THOST_FTDC_TC_IOC;
VolumeCondition = THOST_FTDC_VC_CV;
FAK:
OrderPriceType = THOST_FTDC_OPT_LimitPrice;
TimeCondition = THOST_FTDC_TC_IOC;
VolumeCondition = THOST_FTDC_VC_AV / (THOST_FTDC_VC_MV : MinVolume);

每天只能撤500单，这两种单的撒单不算在内。

### 止盈单 & 止损单
1. 交易所支持才可以, 目地是平已持有的仓位
2. ContingentCondition = THOST_FTDC_CC_Touch / THOST_FTDC_CC_TouchProfit 

### 结算G
1. 商品期货: 合约当日成交价格按照成交量加权平均计算. (成交价格 * 该成交价格的成交量权重 / 总成交量)
2. 股指期货: 以最后1小时成交价格按照成交量加权平均计算。
3. 大涨跌 和 和平均差别大


### 浮动盈亏 & 持仓盈亏 & 平仓盈亏 & 盯市盈亏 & 逐笔盈亏
1. 浮动盈亏 == 逐笔盈亏: 开仓价 - 最新价
2. 平仓盈亏: 开仓价 - 平仓价
3. 持仓盈亏 == 盯市盈亏: 昨日结算价 - 最新价 或 收盘价
4. 开仓当日: 浮动盈亏 == 持仓盈亏

### 保证金
0. 用原价的一定比例，就能拥有一批货，但涨跌是按原价算
1. 冻结保证金是指挂单时占用的保证金，挂单成交以后，冻结保证金转化为占用保证金，当日挂单未成交时，结算以后，冻结保证金转化为可用保证金。
2. 保证金（交易所+期货公司）交易所给到所有的期货公司是一定的，期货公司在上面还可能加几个点
3. 保证金增加:
   1. 持仓量增加 
   2. 临近交割月前一个月，避免违约成本低
   3. 节假日前1,2天。国外不放，国内外有一定的关联性，避免大幅波动影响国内出现涨跌停，
4. 保证金交易 == 杠杆交易

### 期货字母
1. 带有M字母的合约：带有M字母合约说明是主力合约，Main。
2. 带有D字母的合约：带有D字母合约说明此合约是延时行情，Delayed。
3. 带有N字母的合约：带有N字母合约，说明此合约有了重要的新闻公示，News.

### 单向大单边保证金制度
1. 将投资者的同品种持仓视为一个投资组合，对同一客户在同一会员处的同品种双向持仓直接按照保证金金额较大的一边收取交易保证金。
2. eg:你如果有12手黄金多，10手黄金空，那就只收取12手黄金多单的保证金。

### 最优价 & 五档价
1. 最优价（BestPrice）：仅和撮合队列中排在最前面的1个价格的对手方报单进行撮合，CTP标识 THOST_FTDC_OPT_BestPrice。
2. 五档市价（FiveLevelPrice）：有一定的价格保护带，只和撮合队列中排在最前面的5个价格的对手方报单进行撮合，CTP标识THOST_FTDC_OPT_FiveLevelPrice。

### ctp拒单
0. 好像不管成功失败与否，都不会收到 OnRspOrderInsert OnErrRtnOrderInsert
1. 如果报单被CTP直接拒单，会回调OnRspOrderInsert和OnErrRtnOrderInsert函数。
2. OnRspOrderInsert是当前报单者收到的回调，OnErrRtnOrderInsert是账户下所有会话链接都会收到的回调。


??
另一个tcp svr
线路
行情请求task
码表
线路信息管理对象
为什么分到多个队列中比一个线程处理所有高效
为什么有这么多行情类型
CHttpConnectProxyImp 有什么好处

？？交易
1. 用户是怎么注册的
2. 为什么req rsp 的队列中用户名是从配置中取
3. 是不是所有spi回调都有islast
4. 是否报价衍生的报单
5. instrTcpLink.cpp  p16  使用了野指针

### 诊断日记
1. 维持各个级别的N条日志，根据需求推送到client

### 码表
1. 合约信息
2. 从本地数据库取数据
3. 从码表服务器取数据 ？？？？数据哪来的

### CClientReqTask
1. 处理 tcp gas 接收到的请求

### CMarketSubscribeInfo
1. 记录合约被哪些session订阅行情/询价
2. 记录返回的深度和询价信息，判断是否为最新,深度通过时间判断，询价通过询价编号判断
3. 为什么不保存数据???

### CMarketReqTask
0. 加载marketapi 动态库，加载后，marketapi那边会根据配置加载柜台的dll，以lineid进行标识
1. 这边再根据这边的配置，用lineId去创建柜台api
2. 可认为需要调用api的都是通过本类
3. 线路，可看成是柜台，不同的线路，柜台可能一样
4. 管理线路(开启、禁用)
5. 通过配置判断柜台支持哪些交易所

### CMarketLineReq
1. 封装的柜台，被CMarketReqTask包含
2. 订阅、退订过的不再执行，除非失败

### CMarketLineRsp
1. 封装的spi
2. 回调的数据不直接处理，发到CMarketReqTask中
3. 如果是深度行情，发给 CDepthMarketDataTask 和 CWebsocketTask 处理 

### CDepthMarketDataTask
1. 将收到的行情信息发给对应的session

### CWebsocketTask
1. 处理 发、收  的web数据

### CLineInfoMng
1. 记录线路的某些信息，为了计算一些参数

### CWebsocketTask
1. 定时推送数据给前端
2. 接收要发给web的数据到队列中，比如深度行情


交易服
### 请求id
1. 将gac的请求id转成服务器的，返回后，通过请求id找到sessionId和 gac的请求Id

### 前端风控
1. 检查一些数据，再进行报单操作

### CRequestIDMap
1. 管理所有的服务器的requestid与 gac requestid，session的 映射关系

### COrderMapMng
1. 管理所有investor的 requestid 映射
2. 初始化时会创建所有的，那中途怎么加入？？可能是没有完善

### CTradeLineMng
1. 管理traderapi.dll
2. 处理回调队列 CTradeRspTask, 处理请求队列 CTradeReqTask, 内有api和spi
   
### CTradeDBMng
1. 管理所有玩家的数据库请求队列
2. 从数据库取数据，实现就是执行mysql命令取得数据


### hpsocket
1. 接收到http和ws的body信息后，都会再将里中一些数据。不是升级的信息时，都会放入队列中
2. 开启了4个线程，循环的处理队列中的数据，判断信息类型，再从工厂中取处理数据的方法

### 风控
1. 流控:  对某合约或所有合约的指令限制
	指令类型 '0':报单 '1':撤单 '2':报单+撤单 '3':报价 '4':撤报价 '5':报价+撤报价 '6':报单+撤单+报价+撤报价 '7':错误指令
   //对某个合约无非就是这些指令，又不能修改报单
